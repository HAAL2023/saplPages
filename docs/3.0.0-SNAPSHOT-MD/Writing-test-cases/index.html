

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

.site-nav > ul.nav-list:first-child > li > a,
.site-nav > ul.nav-list:first-child > li > ul > li > a,
.site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(6)) > a {
  background-image: none;
}

.site-nav > ul.nav-list:not(:first-child) a,
.site-nav li.external a {
  background-image: none;
}

.site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(9) > ul > li:nth-child(6) > a {
  font-weight: 600;
  text-decoration: none;
}.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg,
.site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(9) > button svg {
  transform: rotate(-90deg);
}.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list,
.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(9) > ul.nav-list {
  display: block;
}
  </style>

  

  
    <script src="/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="icon" href="/assets/sapl_reference_images/favicon.png" type="image/x-icon">



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Writing test cases | SAPL</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Writing test cases" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SAPL is a powerful policy language and engine to implement Attribute-based access control (ABAC). It comes with developement tools for testing, authorization servers, authoring tools. Framework integrations are available for Spring, Axon, and Vaadin to provide flexible policy enforcement points (PEPs) in your application." />
<meta property="og:description" content="SAPL is a powerful policy language and engine to implement Attribute-based access control (ABAC). It comes with developement tools for testing, authorization servers, authoring tools. Framework integrations are available for Spring, Axon, and Vaadin to provide flexible policy enforcement points (PEPs) in your application." />
<link rel="canonical" href="https://heutelbeck.github.io/Writing-test-cases/" />
<meta property="og:url" content="https://heutelbeck.github.io/Writing-test-cases/" />
<meta property="og:site_name" content="SAPL" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Writing test cases" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"SAPL is a powerful policy language and engine to implement Attribute-based access control (ABAC). It comes with developement tools for testing, authorization servers, authoring tools. Framework integrations are available for Spring, Axon, and Vaadin to provide flexible policy enforcement points (PEPs) in your application.","headline":"Writing test cases","url":"https://heutelbeck.github.io/Writing-test-cases/"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="icon" href="/assets/sapl_reference_images/favicon.png" type="image/png">
<!-- Matomo -->
<script type="text/javascript">
    var _paq = window._paq || [];    
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//www.ftk.de/statistik/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<!-- End Matomo Code -->


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="https://sapl.io/" class="site-title lh-tight">
  return to SAPL.io

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in SAPL Reference category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/" class="nav-list-link">SAPL Reference</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/Introduction/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/Authorization-Subscriptions/" class="nav-list-link">Authorization Subscriptions</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/Structure-of-a-SAPL-Policy/" class="nav-list-link">Structure of a SAPL Policy</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/Authorization-Decisions/" class="nav-list-link">Authorization Decisions</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/Accessing-Attributes/" class="nav-list-link">Accessing Attributes</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/Getting-Started/" class="nav-list-link">Getting Started</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference Architecture category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/Reference-Architecture" class="nav-list-link">Reference Architecture</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/pep/" class="nav-list-link">PEP</a>
              </li><li class="nav-list-item">
                <a href="/pdp/" class="nav-list-link">PDP</a>
              </li><li class="nav-list-item">
                <a href="/pap/" class="nav-list-link">PAP</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Publish/Subscribe Protocol category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/Publish-Subscribe-Protocol/" class="nav-list-link">Publish/Subscribe Protocol</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/SAPL-Authorization-Subscription/" class="nav-list-link">SAPL Authorization Subscription</a>
              </li><li class="nav-list-item">
                <a href="/SAPL-Authorization-Decision/" class="nav-list-link">SAPL Authorization Decision</a>
              </li><li class="nav-list-item">
                <a href="/Policy-Evaluation/" class="nav-list-link">Policy Evaluation</a>
              </li><li class="nav-list-item">
                <a href="/Multi-Subscriptions/" class="nav-list-link">Multi Subscriptions</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in PDP APIs category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/PDP-APIs/" class="nav-list-link">PDP APIs</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/HTTP-Server-Sent-Events-API/" class="nav-list-link">HTTP Server-Sent Events API</a>
              </li><li class="nav-list-item">
                <a href="/Java-API/" class="nav-list-link">Java API</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in The SAPL Policy Language category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/The-SAPL-Policy-Language/" class="nav-list-link">The SAPL Policy Language</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/Overview/" class="nav-list-link">Overview</a>
              </li><li class="nav-list-item">
                <a href="/Imports/" class="nav-list-link">Imports</a>
              </li><li class="nav-list-item">
                <a href="/Schemas/" class="nav-list-link">Schemas</a>
              </li><li class="nav-list-item">
                <a href="/SAPL-Policy/" class="nav-list-link">SAPL Policy</a>
              </li><li class="nav-list-item">
                <a href="/SAPL-Policy-Set/" class="nav-list-link">SAPL Policy Set</a>
              </li><li class="nav-list-item">
                <a href="/Language-Elements/" class="nav-list-link">Language Elements</a>
              </li><li class="nav-list-item">
                <a href="/SAPL-Expressions/" class="nav-list-link">SAPL Expressions</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Authorization Subscription Evaluation category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/6_1_AuthorizationSubscriptionEvaluation/" class="nav-list-link">Authorization Subscription Evaluation</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/Policy/" class="nav-list-link">Policy</a>
              </li><li class="nav-list-item">
                <a href="/Policy-Set/" class="nav-list-link">Policy Set</a>
              </li><li class="nav-list-item">
                <a href="/Authorization-Subscription/" class="nav-list-link">Authorization Subscription</a>
              </li><li class="nav-list-item">
                <a href="/Combining-Algorithm/" class="nav-list-link">Combining Algorithm</a>
              </li><li class="nav-list-item">
                <a href="/Transformation/" class="nav-list-link">Transformation</a>
              </li><li class="nav-list-item">
                <a href="/Obligation-Advice/" class="nav-list-link">Obligation / Advice</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Functions category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/Functions/" class="nav-list-link">Functions</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/Custom-Function-Libraries/" class="nav-list-link">Custom Function Libraries</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Attribute Finders category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/Attribute-Finders/" class="nav-list-link">Attribute Finders</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/Custom-Attribute-Finders/" class="nav-list-link">Custom Attribute Finders</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Testing SAPL policies category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/Testing-SAPL-policies/" class="nav-list-link">Testing SAPL policies</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/Usage-scenarios/" class="nav-list-link">Usage scenarios</a>
              </li><li class="nav-list-item">
                <a href="/Embedded-PDP/" class="nav-list-link">Embedded PDP</a>
              </li><li class="nav-list-item">
                <a href="/SAPL-Server/" class="nav-list-link">SAPL Server</a>
              </li><li class="nav-list-item">
                <a href="/Unit-Tests/" class="nav-list-link">Unit-Tests</a>
              </li><li class="nav-list-item">
                <a href="/Policy-Integration-Tests/" class="nav-list-link">Policy-Integration-Tests</a>
              </li><li class="nav-list-item">
                <a href="/Writing-test-cases/" class="nav-list-link">Writing test cases</a>
              </li><li class="nav-list-item">
                <a href="/Code-Coverage-Reports-via-the-SAPL-Maven-Plugin/" class="nav-list-link">Code Coverage Reports via the SAPL Maven Plugin</a>
              </li></ul></li></ul></li></ul>

  <ul class="nav-list"><li class="nav-list-item external">
          <a href="https://github.com/heutelbeck/sapl-policy-engine" class="nav-list-link external"
            
          >
            SAPL on GitHub
            <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
          </a>
        </li></ul>
</nav>


  
  
    <br>

  
</div>

  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SAPL" aria-label="Search SAPL" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/heutelbeck/sapl-policy-engine" class="site-button"
          
        >
          SAPL on GitHub
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
  
    <li class="breadcrumb-nav-list-item"><a href="/">SAPL Reference</a></li>
    <li class="breadcrumb-nav-list-item"><a href="/Testing-SAPL-policies/">Testing SAPL policies</a></li>
  <li class="breadcrumb-nav-list-item"><span>Writing test cases</span></li>
  </ol>
</nav>
      <div id="main-content" class="main-content">
        <main>
          
            <h3 id="writing-test-cases">
  
  
    <a href="#writing-test-cases" class="anchor-heading" aria-labelledby="writing-test-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Writing test cases
  
  
</h3>
    

<p>The Step-Builder-Pattern is used for defining the concrete test case. It consists of the following four steps:</p>

<ul>
  <li>Given-Step: Define mocks for attributes and functions</li>
  <li>When-Step: Specify the <code class="language-plaintext highlighter-rouge">AuthorizationSubscription</code></li>
  <li>Expect-Step: Define expectations for generated <code class="language-plaintext highlighter-rouge">AuthorizationDecision</code></li>
  <li>Verify-Step: Verify the generated <code class="language-plaintext highlighter-rouge">AuthorizationDecision</code>
<br /><br /></li>
</ul>

<p><img src="/sapl-reference/assets/sapl_reference_images/StepBuilderPatternForSaplTest_English.svg" alt="StepBuilderPatternForSaplTest_English" /></p>

<p><br /><br />
Starting with constructTestCaseWithMocks() or constructTestCase() called on the fixture, the test case definition process is started at the Given-Step or the When-Step.</p>
<h4 id="given-step">
  
  
    <a href="#given-step" class="anchor-heading" aria-labelledby="given-step"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Given-Step
  
  
</h4>
    

<p><strong>Mocking of functions</strong>:</p>

<ul>
  <li>the <code class="language-plaintext highlighter-rouge">givenFunction</code> methods can be used to mock a function returning a <code class="language-plaintext highlighter-rouge">Val</code> specified in the method parameters for every call.
    <ul>
      <li>
        <p>a single value can be specified</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenFunction</span><span class="o">(</span><span class="s">"time.dayOfWeek"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"SATURDAY"</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
      <li>
        <p>a single value only returned when the parameters of the function call match some expectations</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenFunction</span><span class="o">(</span><span class="s">"corp.subjectConverter"</span><span class="o">,</span>
    <span class="n">whenFunctionParams</span><span class="o">(</span><span class="n">is</span><span class="o">(</span><span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)),</span> <span class="n">is</span><span class="o">(</span><span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"nikolai"</span><span class="o">))),</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"ROLE_ADMIN"</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
      <li>
        <p>or a Lambda-Expression evaluating the parameters of the function call</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenFunction</span><span class="o">(</span><span class="s">"company.complexFunction"</span><span class="o">,</span> <span class="o">(</span><span class="nc">FunctionCall</span> <span class="n">call</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    
    <span class="c1">//probably one should check for number and type of parameters first</span>
    <span class="nc">Double</span> <span class="n">param0</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">getArgument</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">().</span><span class="na">asDouble</span><span class="o">();</span>
    <span class="nc">Double</span> <span class="n">param1</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">getArgument</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">get</span><span class="o">().</span><span class="na">asDouble</span><span class="o">();</span>
    
    <span class="k">return</span> <span class="n">param0</span> <span class="o">%</span> <span class="n">param1</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">:</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="o">})</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
      <li>
        <p>and verify the number of calls to this mock</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenFunction</span><span class="o">(</span><span class="s">"time.dayOfWeek"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"SATURDAY"</span><span class="o">),</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">givenFunctionOnce</code> can specify a <code class="language-plaintext highlighter-rouge">Val</code> or multiple <code class="language-plaintext highlighter-rouge">Val</code>-Objects which are emitted once (in a sequence) when this mocked function is called
    <ul>
      <li>
        <p>a single value</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenFunctionOnce</span><span class="o">(</span><span class="s">"time.secondOf"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">4</span><span class="o">))</span>
<span class="o">.</span><span class="na">givenFunctionOnce</span><span class="o">(</span><span class="s">"time.secondOf"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
      <li>
        <p>or a sequence of values</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenFunctionOnce</span><span class="o">(</span><span class="s">"time.secondOf"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">4</span><span class="o">),</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Mocking of attributes</strong>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">givenAttribute</code> methods can mock attributes
    <ul>
      <li>
        <p>to return one or more <code class="language-plaintext highlighter-rouge">Val</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenAttribute</span><span class="o">(</span><span class="s">"time.now"</span><span class="o">,</span> <span class="n">timestamp0</span><span class="o">,</span> <span class="n">timestamp1</span><span class="o">,</span> <span class="n">timestamp2</span><span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
      <li>
        <p>to return a sequence of <code class="language-plaintext highlighter-rouge">Val</code> in an interval of <code class="language-plaintext highlighter-rouge">Duration</code>. Using <code class="language-plaintext highlighter-rouge">withVirtualTime</code> activates the virtual time feature of Project Reactor</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">withVirtualTime</span><span class="o">()</span>
<span class="o">.</span><span class="na">givenAttribute</span><span class="o">(</span><span class="s">"time.now"</span><span class="o">,</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">timestamp0</span><span class="o">,</span> <span class="n">timestamp1</span><span class="o">,</span> <span class="n">timestamp2</span><span class="o">,</span> <span class="n">timestamp3</span><span class="o">,</span> <span class="n">timestamp4</span><span class="o">,</span> <span class="n">timestamp5</span><span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<blockquote class="warning">
  <p>The virtual time feature can be used with real time-based PIPs registered the fixture level. Virtual time is “no silver bullet” to cite the <a href="https://projectreactor.io/docs/core/release/reference/#_manipulating_time">Project Reactor Reference Guide</a>. It says further that “[v]irtual time also gets very limited with infinite sequences, which might hog the thread on which both the sequence and its verification run.”</p>
</blockquote>

<ul>
  <li>
    <p>to mark an attribute to be mocked and specify return values in a sequence next to expectations</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenAttribute</span><span class="o">(</span><span class="s">"company.pip1"</span><span class="o">)</span>
<span class="o">.</span><span class="na">givenAttribute</span><span class="o">(</span><span class="s">"company.pip2"</span><span class="o">)</span>
<span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="nc">AuthorizationSubscription</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"User1"</span><span class="o">,</span> <span class="s">"read"</span><span class="o">,</span> <span class="s">"heartBeatData"</span><span class="o">))</span>
<span class="o">.</span><span class="na">thenAttribute</span><span class="o">(</span><span class="s">"company.pip1"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
<span class="o">.</span><span class="na">thenAttribute</span><span class="o">(</span><span class="s">"company.pip2"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span>
<span class="o">.</span><span class="na">expectNextPermit</span><span class="o">()</span>
<span class="o">.</span><span class="na">thenAttribute</span><span class="o">(</span><span class="s">"company.pip2"</span><span class="o">,</span> <span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
<span class="o">.</span><span class="na">expectNextNotApplicable</span><span class="o">()</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>to mock an attribute depending on the parent value</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenAttribute</span><span class="o">(</span><span class="s">"test.upper"</span><span class="o">,</span> <span class="n">whenParentValue</span><span class="o">(</span><span class="n">val</span><span class="o">(</span><span class="s">"willi"</span><span class="o">)),</span> <span class="n">thenReturn</span><span class="o">(</span><span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"WILLI"</span><span class="o">)))</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>to mock an attribute depending on the parent value and every value the arguments are called for</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">givenAttribute</span><span class="o">(</span><span class="s">"pip.attributeWithParams"</span><span class="o">,</span> <span class="n">whenAttributeParams</span><span class="o">(</span><span class="n">parentValue</span><span class="o">(</span><span class="n">val</span><span class="o">(</span><span class="kc">true</span><span class="o">)),</span> <span class="n">arguments</span><span class="o">(</span><span class="n">val</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">val</span><span class="o">(</span><span class="mi">2</span><span class="o">))),</span> <span class="n">thenReturn</span><span class="o">(</span><span class="nc">Val</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="kc">true</span><span class="o">)))</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ul>

<p>Further mock types or overloaded methods are available <a href="https://github.com/heutelbeck/sapl-policy-engine/blob/master/sapl-test/src/main/java/io/sapl/test/steps/GivenStep.java">here</a>.</p>
<h4 id="when-step">
  
  
    <a href="#when-step" class="anchor-heading" aria-labelledby="when-step"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> When-Step
  
  
</h4>
    

<p>The next defines the <code class="language-plaintext highlighter-rouge">AuthorizationSubscription</code> for the policy evaluation.</p>

<ul>
  <li>
    <p>pass an <code class="language-plaintext highlighter-rouge">AuthorizationSubscription</code> created by it’s factory methods</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="nc">AuthorizationSubscription</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"willi"</span><span class="o">,</span> <span class="s">"read"</span><span class="o">,</span> <span class="s">"something"</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>pass a JSON-String to be parsed to an <code class="language-plaintext highlighter-rouge">AuthorizationSubscription</code> via the framework</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="s">"{\"subject\":\"willi\", \"action\":\"read\", \"resource\":\"something\", \"environment\":{}}"</span><span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>pass a <code class="language-plaintext highlighter-rouge">JsonNode</code> object of the Jackson-Framework (<a href="https://fasterxml.github.io/jackson-databind/javadoc/2.7/com/fasterxml/jackson/databind/JsonNode.html">Reference</a>)</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nc">JsonNode</span> <span class="n">authzSub</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">createObjectNode</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"subject"</span><span class="o">,</span> <span class="s">"willi"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"action"</span><span class="o">,</span> <span class="s">"read"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"resource"</span><span class="o">,</span> <span class="s">"something"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"environment"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">);</span>
<span class="o">...</span>
    <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">authzSub</span><span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ul>
<h4 id="expect-step">
  
  
    <a href="#expect-step" class="anchor-heading" aria-labelledby="expect-step"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expect-Step
  
  
</h4>
    

<p>This step defines the expected <code class="language-plaintext highlighter-rouge">AuthorizationDecision</code>.</p>

<ul>
  <li>
    <p>check only the Decision via</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">expectPermit</span><span class="o">()</span>
<span class="o">.</span><span class="na">expectDeny</span><span class="o">()</span>
<span class="o">.</span><span class="na">expectIndeterminate</span><span class="o">()</span>
<span class="o">.</span><span class="na">expectNotApplicable</span><span class="o">()</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>pass a <code class="language-plaintext highlighter-rouge">AuthorizationDecision</code> object to be checked for equality</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nc">ObjectNode</span> <span class="n">obligation</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">createObjectNode</span><span class="o">();</span>
<span class="n">obligation</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"logAccess"</span><span class="o">);</span>
<span class="n">obligation</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"Willi has accessed patient data (id=56) as an administrator."</span><span class="o">);</span>
<span class="nc">ArrayNode</span> <span class="n">obligations</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">createArrayNode</span><span class="o">();</span>
<span class="n">obligations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">obligation</span><span class="o">);</span>
  
<span class="nc">AuthorizationDecision</span> <span class="n">decision</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AuthorizationDecision</span><span class="o">(</span><span class="nc">Decision</span><span class="o">.</span><span class="na">PERMIT</span><span class="o">).</span><span class="na">withObligations</span><span class="o">(</span><span class="n">obligations</span><span class="o">);</span>
  
<span class="o">...</span>
  
    <span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="n">decision</span><span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>use a predicate function to manually define checks</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">expect</span><span class="o">((</span><span class="nc">AuthorizationDecision</span> <span class="n">dec</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// some complex and custom assertions</span>
    <span class="k">if</span><span class="o">(</span><span class="n">dec</span><span class="o">.</span><span class="na">getObligations</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">})</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li>
    <p>Hamcrest matchers provided by the sapl-hamcrest module can be used to express complex expectations on the decision, obligations, advice or resources of the <code class="language-plaintext highlighter-rouge">AuthorizationDecision</code></p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">expect</span><span class="o">(</span>
    <span class="n">allOf</span><span class="o">(</span>
        <span class="n">isPermit</span><span class="o">(),</span>
        <span class="n">hasObligationContainingKeyValue</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"logAccess"</span><span class="o">),</span>
        <span class="n">isResourceMatching</span><span class="o">((</span><span class="nc">JsonNode</span> <span class="n">resource</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">resource</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">asText</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"56"</span><span class="o">))</span>
        <span class="o">...</span>
    <span class="o">)</span>
<span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>

    <p>All available <code class="language-plaintext highlighter-rouge">Matcher&lt;AuthorizationDecision&gt;</code> can be found <a href="https://github.com/heutelbeck/sapl-policy-engine/blob/master/sapl-hamcrest/src/main/java/io/sapl/hamcrest/Matchers.java">here</a></p>
  </li>
</ul>

<p>These methods come with additional methods (e.g., <code class="language-plaintext highlighter-rouge">expectNextPermit</code>) to define multiple expectations for testing stream-based policies.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="na">expectNextPermit</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>More available methods are documented <a href="https://github.com/heutelbeck/sapl-policy-engine/blob/master/sapl-test/src/main/java/io/sapl/test/steps/ExpectStep.jav">here</a>.</p>
<h4 id="verify-step">
  
  
    <a href="#verify-step" class="anchor-heading" aria-labelledby="verify-step"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Verify-Step
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">verify()</code> method completes the test definition, and triggers the evaluation of the policy/policies and verifies the expectations.</p>


          

          
        </main>
        

  <hr>
  <footer>
    
      <p><a href="#top" id="back-to-top">Back to top</a></p>
    

    <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2024 Dominic Heutelbeck. Distributed by an <a href="https://github.com/heutelbeck/sapl-policy-engine/blob/master/LICENSE.md">License.</a></p>

    
      <div class="d-flex mt-2">
        
        
      </div>
    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    






  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>


<script>
  var config = {}
;
  mermaid.initialize(config);
  window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>



  
</body>
</html>

